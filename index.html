<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>ุนุฑุถ ุจุงููุฑุงูู ูุจุนุถ ูุดุงุฑูุนูุง ุนุตุงู ุงูููุฑุจุงุฆู</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css">
    <style>
        /* ุชูุณููุงุช ูุฌุนู ุงูุจุงููุฑุงูุง ุชููุฃ ุงูุดุงุดุฉ */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        #panorama {
            width: 100%;
            height: 100%;
            position: relative; /* ููู ููุถุน ุฃุฒุฑุงุฑ ุงูุชุญูู ููู ุงูุจุงููุฑุงูุง */
        }

        /* ุชูุณูู ุญุงููุฉ ุฃุฒุฑุงุฑ ุงูุชุญูู ูู ุงูุฃุณูู */
        #controlsContainer {
            position: absolute;
            bottom: 20px;
            right: 20px;
            left: 20px;
            display: flex;
            justify-content: space-between; /* ุชูุฒูุน ุงูุฃุฒุฑุงุฑ */
            align-items: flex-end;
            z-index: 10;
            gap: 10px; /* ูุณุงูุฉ ุจูู ูุฌููุนุงุช ุงูุฃุฒุฑุงุฑ */
        }

        /* ุชูุณูู ุฃุฒุฑุงุฑ ุงูุชุญูู ุงูุนุงูุฉ */
        .control-button {
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            border-radius: 50%; /* ูุฌุนู ุงูุฒุฑ ุฏุงุฆุฑููุง */
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: background-color 0.3s ease, transform 0.2s;
        }
        .control-button:hover {
            background-color: rgba(0, 0, 0, 0.8);
            transform: scale(1.05);
        }
        .control-button:active {
            transform: scale(0.95);
        }
        .control-button svg {
            fill: white;
            width: 70%;
            height: 70%;
        }

        /* ูุฌููุนุฉ ุฃุฒุฑุงุฑ ุงูุณุฑุนุฉ */
        #speedControls {
            display: flex;
            gap: 10px;
        }

        /* ูุฌููุนุฉ ุฃุฒุฑุงุฑ ุงูุชููู ุจูู ุงูุตูุฑ */
        #navigationControls {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>

    <div id="panorama"></div>

    <audio id="backgroundMusic" loop>
        <source src="background_music.mp3" type="audio/mpeg">
        ูุชุตูุญู ูุง ูุฏุนู ุนูุตุฑ ุงูุตูุช.
    </audio>

    <div id="controlsContainer">
        <div id="speedControls">
            <button id="speedDownBtn" class="control-button">๐ข</button> <button id="speedUpBtn" class="control-button">๐</button> </div>

        <button id="audioControlBtn" class="control-button">๐</button>

        <div id="navigationControls">
            <button id="prevPanoBtn" class="control-button">
                <svg viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg>
            </button>
            <button id="nextPanoBtn" class="control-button">
                <svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>
            </button>
        </div>
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    <script type="text/javascript">
        // ูุงุฆูุฉ ุจูุณุงุฑุงุช ุตูุฑ ุงูุจุงููุฑุงูุง
        const panoramas = [
            { type: 'equirectangular', path: 'images/pano1.jpg' },
            { type: 'equirectangular', path: 'images/pano2.jpg' },
            { type: 'equirectangular', path: 'images/pano3.jpg' },
            { type: 'equirectangular', path: 'images/pano4.jpg' },
            { type: 'equirectangular', path: 'images/pano5.jpg' },
            { type: 'equirectangular', path: 'images/pano6.jpg' },
            { type: 'equirectangular', path: 'images/pano7.jpg' },
            { type: 'equirectangular', path: 'images/pano8.jpg' },
            { type: 'equirectangular', path: 'images/pano9.jpg' },
            { type: 'equirectangular', path: 'images/pano10.jpg' },
            { type: 'equirectangular', path: 'images/pano11.jpg' },
            { type: 'equirectangular', path: 'videos/my_360_video.mp4', video: true } 
            // ุชุฃูุฏ ูู ุฃู ูุฐุง ุงููุณุงุฑ ูููู ุงูููุฏูู ุตุญูุญ ูุฃู ุงูููู ููุฌูุฏ
            // ุฃุถู ุงููุฒูุฏ ูู ุงูุตูุฑ ุฃู ุงูููุฏูููุงุช ููุง
        ];

        let currentIndex = 0; // ูุคุดุฑ ุงูุตูุฑุฉ ุงูุญุงููุฉ
        let panoramaViewer = null; // ูุชุบูุฑ ููุดุบู Pannellum
        let inactivityTimeoutId; // ูุนุฑู ุงููุคูุช ุงูุฎุงุต ุจุนุฏู ุงููุดุงุท
        let autoTransitionTimeoutId; // ูุคูุช ุงูุงูุชูุงู ุงูุชููุงุฆู ุจูู ุงูุตูุฑ
        
        // ุฅุนุฏุงุฏุงุช ุงูุฏูุฑุงู ูุงูุณุฑุนุฉ (ูููู ุชุนุฏูููุง)
        let currentRotationSpeed = -5; // ุณุฑุนุฉ ุงูุฏูุฑุงู ุงูุงูุชุฑุงุถูุฉ (ุณุงูุจ ูููุณุงุฑุ ููุฌุจ ูููููู)
        const rotationSpeedStep = 2; // ููุฏุงุฑ ุงูุชุบููุฑ ูู ุงูุณุฑุนุฉ

        // ูุฏุฉ ุนุฑุถ ูู ุจุงููุฑุงูุง ูุจู ุงูุงูุชูุงู ุงูุชููุงุฆู
        const panoramaDisplayDuration = 30000; 

        // 5 ุซูุงูู ูู ุนุฏู ุงููุดุงุท ูุฅุนุงุฏุฉ ุชุดุบูู ุงูุฏูุฑุงู ุงูุชููุงุฆู
        const inactivityDelay = 500; 
        
        // ุงูุญุตูู ุนูู ุนูุงุตุฑ ุงูุตูุช ูุงูุชุญูู ููู
        const backgroundMusic = document.getElementById('backgroundMusic');
        const audioControlBtn = document.getElementById('audioControlBtn');
        const speedUpBtn = document.getElementById('speedUpBtn');
        const speedDownBtn = document.getElementById('speedDownBtn');
        const prevPanoBtn = document.getElementById('prevPanoBtn');
        const nextPanoBtn = document.getElementById('nextPanoBtn');


        // ูุชุบูุฑ ูุชุชุจุน ุญุงูุฉ ุงูุตูุช (ุตุงูุช ุฃู ูุง)
        let isMuted = true; // ุงุจุฏุฃ ูุตุงูุช

        // ุฏุงูุฉ ูุชุดุบูู/ุฅููุงู ุงูุตูุช
        function toggleAudio() {
            if (backgroundMusic.paused) {
                backgroundMusic.play().then(() => {
                    audioControlBtn.textContent = '๐'; // ุฑูุฒ ุตูุช ูุฑุชูุน
                    isMuted = false;
                }).catch(error => {
                    console.error("Failed to play audio:", error);
                    alert("ุงููุชุตูุญ ููุน ุงูุชุดุบูู ุงูุชููุงุฆู ููุตูุช. ุงูุฑุฌุงุก ุงูุณูุงุญ ุจุฐูู ูุฏูููุง.");
                });
            } else {
                backgroundMusic.pause();
                audioControlBtn.textContent = '๐'; // ุฑูุฒ ุตุงูุช
                isMuted = true;
            }
        }

        // ุฏุงูุฉ ูุชุบููุฑ ุณุฑุนุฉ ุงูุฏูุฑุงู ุงูุชููุงุฆู
        function changeRotationSpeed(direction) {
            if (!panoramaViewer) return; // ูุง ุชูุนู ุดูุฆุงู ุฅุฐุง ูู ููู ุงููุดุบู ููุฌูุฏุงู

            const oldSpeed = currentRotationSpeed;

            if (direction === 'up') {
                currentRotationSpeed -= rotationSpeedStep; // ูููุณุงุฑ (ุฃุณุฑุน)
                if (currentRotationSpeed < -30) currentRotationSpeed = -30; // ุญุฏ ุฃูุตู ููุณุฑุนุฉ
            } else if (direction === 'down') {
                currentRotationSpeed += rotationSpeedStep; // ูููููู (ุฃุจุทุฃ)
                if (currentRotationSpeed > 30) currentRotationSpeed = 30; // ุญุฏ ุฃุฏูู ููุณุฑุนุฉ
            }
            
            // ูุฅููุงู ุงูุฏูุฑุงู ุชูุงูุงู ูููู ุถุจุท ุงูุณุฑุนุฉ ุนูู 0
            if (currentRotationSpeed === 0) {
                 panoramaViewer.stopAutoRotate();
                 console.log("Auto-rotation stopped.");
            } else {
                 // ุชููู ุซู ุฃุนุฏ ุชุดุบูู ุงูุฏูุฑุงู ุจุงูุณุฑุนุฉ ุงูุฌุฏูุฏุฉ
                 panoramaViewer.stopAutoRotate(); 
                 panoramaViewer.startAutoRotate(currentRotationSpeed);
                 console.log("Rotation Speed set to:", currentRotationSpeed);
            }

            // ุฃุนุฏ ุถุจุท ุงููุคูุช ุนุฏู ุงููุดุงุท ููุชุฃูุฏ ูู ุงุณุชูุฑุงุฑ ุงูุณููู ุงููุทููุจ
            // ููุท ุฅุฐุง ูู ููู ุงูุฏูุฑุงู ุตูุฑุงู
            if (currentRotationSpeed !== 0) {
                resetInactivityTimer();
            } else {
                clearTimeout(inactivityTimeoutId); // ูุง ุญุงุฌุฉ ููุคูุช ุนุฏู ุงููุดุงุท ุฅุฐุง ุชููู ุงูุฏูุฑุงู
            }
        }

        // ุฏุงูุฉ ููุงูุชูุงู ุฅูู ุงูุตูุฑุฉ ุงูุชุงููุฉ
        function showNextPanorama() {
            clearTimeout(inactivityTimeoutId); // ุฅูุบุงุก ูุคูุช ุนุฏู ุงููุดุงุท
            clearTimeout(autoTransitionTimeoutId); // ุฅูุบุงุก ูุคูุช ุงูุงูุชูุงู ุงูุชููุงุฆู

            loadPanorama(currentIndex + 1);
            resetInactivityTimer(); // ุงุจุฏุฃ ูุคูุช ุนุฏู ุงููุดุงุท ุงูุฌุฏูุฏ ูุจุงุดุฑุฉ ุจุนุฏ ุงูุชุบููุฑ ุงููุฏูู
        }

        // ุฏุงูุฉ ููุงูุชูุงู ุฅูู ุงูุตูุฑุฉ ุงูุณุงุจูุฉ
        function showPreviousPanorama() {
            clearTimeout(inactivityTimeoutId); // ุฅูุบุงุก ูุคูุช ุนุฏู ุงููุดุงุท
            clearTimeout(autoTransitionTimeoutId); // ุฅูุบุงุก ูุคูุช ุงูุงูุชูุงู ุงูุชููุงุฆู

            let newIndex = currentIndex - 1;
            if (newIndex < 0) {
                newIndex = panoramas.length - 1; // ุงูุนูุฏุฉ ููููุงูุฉ ุฅุฐุง ูุตููุง ููุจุฏุงูุฉ
            }
            loadPanorama(newIndex);
            resetInactivityTimer(); // ุงุจุฏุฃ ูุคูุช ุนุฏู ุงููุดุงุท ุงูุฌุฏูุฏ ูุจุงุดุฑุฉ ุจุนุฏ ุงูุชุบููุฑ ุงููุฏูู
        }

        // ุฏุงูุฉ ูุฅุนุงุฏุฉ ุถุจุท ูุคูุช ุนุฏู ุงููุดุงุท
        function resetInactivityTimer() {
            // ูู ุจูุณุญ ุงููุคูุช ุงููุฏูู
            clearTimeout(inactivityTimeoutId);

            // ุฃุนุฏ ุถุจุท ุงููุคูุช
            inactivityTimeoutId = setTimeout(() => {
                // ุชุฃูุฏ ุฃู ุงููุดุบู ููุฌูุฏ ูุฃู ุงูุฏูุฑุงู ุงูุชููุงุฆู ููุณ ุตูุฑูุง
                if (panoramaViewer && currentRotationSpeed !== 0) {
                    console.log("No activity detected, attempting to resume auto-rotation.");
                    // **** ุงูุชุบููุฑ ุงูุฑุฆูุณู ููุง ****
                    // ุจุฏูุงู ูู ุฅุนุงุฏุฉ ุงูุชุญููู ุงููุงูู ุฃู ูุญุงููุฉ setAutorotate
                    // ุณูููู ููุท ุจูุญุงููุฉ ุงุณุชุฆูุงู ุงูุฏูุฑุงู. Pannellum ูุฌุจ ุฃู ูุนุงูุฌ ูุฐุง.
                    // ุฅุฐุง ูู ูุณุชุฃูู ุชููุงุฆููุงุ ูุงูููุชุจุฉ ูุง ุชุฏุนู ุฐูู ุจุดูู ูุงูู ุจุนุฏ ุงูุชูุงุนู.
                    
                    // ููุฌุจุฑ Pannellum ุนูู ุฅุนุงุฏุฉ ุชูููู ุญุงูุชู ุนู ุทุฑูู ุฅุนุงุฏุฉ ุถุจุท ุฒุงููุฉ ุงูุนุฑุถ
                    // ูุฐู ุงูุทุฑููุฉ ุฃูุทู ูู ุฅุนุงุฏุฉ ุงูุชุญููู ุงููุงูู ููุง ุชุณุจุจ ูููุถุงู.
                    panoramaViewer.setYaw(panoramaViewer.getYaw(), 0); // ุฅุนุงุฏุฉ ุถุจุท Yaw ุฏูู ุญุฑูุฉุ ููุท ููุชูุจูู
                    panoramaViewer.setPitch(panoramaViewer.getPitch(), 0); // ุฅุนุงุฏุฉ ุถุจุท Pitch
                    
                    panoramaViewer.startAutoRotate(currentRotationSpeed); // ุงุณุชุฆูุงู ุงูุฏูุฑุงู ุจุงูุณุฑุนุฉ ุงูุญุงููุฉ

                    // ููููู ุฃูุถุงู ุฅุถุงูุฉ log ููุชุญูู ููุง ุฅุฐุง ูุงู ุงูุฏูุฑุงู ูุดุทุงู:
                    // console.log("Autorotate active?", panoramaViewer.getAutorotate());
                    // (ุชุฐูุฑ: getAutorotate ูุฏ ูุง ูููู ูุชุงุญุงู ูู ุจุนุถ ุงูุฅุตุฏุงุฑุงุช)
                    // **************************
                }
            }, inactivityDelay);
        }

        // ุฏุงูุฉ ูุนุฑุถ ุงูุจุงููุฑุงูุง
        function loadPanorama(index) {
            // ูู ุจุฅูุบุงุก ุฃู ูุคูุชุงุช ุณุงุจูุฉ
            clearTimeout(inactivityTimeoutId);
            clearTimeout(autoTransitionTimeoutId); 

            if (index >= panoramas.length) {
                currentIndex = 0; // ุงูุนูุฏุฉ ููุตูุฑุฉ ุงูุฃููู ุฅุฐุง ูุตููุง ููููุงูุฉ
            } else if (index < 0) {
                currentIndex = panoramas.length - 1; // ุงูุงูุชูุงู ูุขุฎุฑ ุตูุฑุฉ ุฅุฐุง ุฑุฌุนูุง ูู ุงูุฃููู
            } else {
                currentIndex = index;
            }

            // ุงูุขู ูุตู ุฅูู ุงููุงุฆู ูููุณ ููุท ุงููุณุงุฑ
            const currentPanoObject = panoramas[currentIndex];
            const currentPanoramaPath = currentPanoObject.path;
            const isVideo = currentPanoObject.video || false; // ููุชุญูู ูุง ุฅุฐุง ูุงู ุงูุนูุตุฑ ุงูุญุงูู ููุฏูู

            console.log(`Loading panorama: ${currentPanoramaPath} (Index: ${currentIndex}), Is Video: ${isVideo}`);

            // ุฅุฐุง ูุงู ููุงู ูุดุบู ููุฌูุฏุ ูู ุจุชุฏููุฑู ุฃููุงู
            if (panoramaViewer) {
                panoramaViewer.destroy();
                panoramaViewer = null; // ุชุนูููู ุฅูู null ุจุนุฏ ุงูุชุฏููุฑ
                document.getElementById('panorama').innerHTML = '';
            }
            
            // ุงูุขูุ ูู ุจุฅูุดุงุก ูุดุบู ุฌุฏูุฏ ุฏุงุฆููุง
            const viewerOptions = {
                "type": isVideo ? 'video' : 'equirectangular', // ููุง ูุญุฏุฏ ููุน 'video' ุฅุฐุง ูุงู ููุฏูู
                "panorama": currentPanoramaPath,
                "autoLoad": true,
                "autoRotate": currentRotationSpeed, // ุงุณุชุฎุฏู ุงูุณุฑุนุฉ ุงูุญุงููุฉ ููุง
                "compass": true,
                "mouseZoom": true,
                "showControls": true,
                "loop": isVideo ? true : false // ุชูุฑุงุฑ ุงูููุฏูู ุฅุฐุง ูุงู ููุฏูู
            };

            panoramaViewer = pannellum.viewer('panorama', viewerOptions);

            // ุฅุถุงูุฉ ูุณุชูุนู ุฃุญุฏุงุซ ููุชุญูู ูู ุงูุชูุงุนู ุจุนุฏ ุฅูุดุงุก ุงููุดุบู
            panoramaViewer.on('mousedown', resetInactivityTimer);
            panoramaViewer.on('touchstart', resetInactivityTimer);
            panoramaViewer.on('mousewheel', resetInactivityTimer); 
            panoramaViewer.on('touchend', resetInactivityTimer);
            
            // ุถุจุท ุงููุคูุช ููุงูุชูุงู ุฅูู ุงูุจุงููุฑุงูุง ุงูุชุงููุฉ ุจุนุฏ ูุฏุฉ ูุญุฏุฏุฉ
            autoTransitionTimeoutId = setTimeout(() => {
                console.log(`Transitioning to next panorama after ${panoramaDisplayDuration / 1000} seconds.`);
                loadPanorama(currentIndex + 1);
            }, panoramaDisplayDuration);
            
            // ุถุจุท ุงููุคูุช ุงูุฃููู ูุนุฏู ุงููุดุงุท ุจุนุฏ ุชุญููู ุงูุจุงููุฑุงูุง
            // **ูุงู:** ูุง ุชุณุชุฏุนู resetInactivityTimer ููุง ูุจุงุดุฑุฉู ุฅุฐุง ูุงูุช ุงูุณุฑุนุฉ ุตูุฑูุง
            if (currentRotationSpeed !== 0) {
                resetInactivityTimer();
            }
        }

        // ุฑุจุท ุงูุฃุฒุฑุงุฑ ุจุงููุธุงุฆู
        document.addEventListener('DOMContentLoaded', () => {
            // ุฑุจุท ุฒุฑ ุงูุตูุช
            audioControlBtn.addEventListener('click', toggleAudio);

            // ุฑุจุท ุฃุฒุฑุงุฑ ุงูุณุฑุนุฉ
            speedUpBtn.addEventListener('click', () => changeRotationSpeed('up'));
            speedDownBtn.addEventListener('click', () => changeRotationSpeed('down'));

            // ุฑุจุท ุฃุฒุฑุงุฑ ุงูุชููู
            prevPanoBtn.addEventListener('click', showPreviousPanorama);
            nextPanoBtn.addEventListener('click', showNextPanorama);

            if (panoramas.length > 0) {
                loadPanorama(0); // ุจุฏุก ุงูุนุฑุถ ูู ุงูุตูุฑุฉ ุงูุฃููู
            } else {
                // ุฑุณุงูุฉ ูู ุญุงูุฉ ุนุฏู ูุฌูุฏ ุตูุฑ
                document.getElementById('panorama').innerHTML = '<div style="color: #666; font-size: 1.5em; text-align: center; padding-top: 100px;">ุงูุฑุฌุงุก ุฅุถุงูุฉ ุตูุฑ ุจุงููุฑุงูุง ุฅูู ูุฌูุฏ "images".</div>';
            }
        });
    </script>

</body>
</html>
